// Generated by Haxe 4.1.0-rc.1+0d88c583b

#pragma warning disable 109, 114, 219, 429, 168, 162
namespace web.proto {
	public class Web_Error : global::haxe.lang.Enum {
		
		protected Web_Error(int index) : base(index) {
		}
		
		
		public static readonly global::web.proto.Web_Error OK = new global::web.proto.Web_Error_OK();
		
		public static readonly global::web.proto.Web_Error ERROR = new global::web.proto.Web_Error_ERROR();
		
		protected static readonly string[] __hx_constructs = new string[]{"OK", "ERROR"};
		
	}
}



#pragma warning disable 109, 114, 219, 429, 168, 162
namespace web.proto {
	public sealed class Web_Error_OK : global::web.proto.Web_Error {
		
		public Web_Error_OK() : base(0) {
		}
		
		
		public override string getTag() {
			return "OK";
		}
		
		
	}
}



#pragma warning disable 109, 114, 219, 429, 168, 162
namespace web.proto {
	public sealed class Web_Error_ERROR : global::web.proto.Web_Error {
		
		public Web_Error_ERROR() : base(1) {
		}
		
		
		public override string getTag() {
			return "ERROR";
		}
		
		
	}
}



#pragma warning disable 109, 114, 219, 429, 168, 162
namespace web.proto {
	public class PacketBuilder : global::haxe.lang.HxObject {
		
		static PacketBuilder() {
			unchecked{
				global::web.proto.PacketBuilder.HEADER_SIZE = 10;
			}
		}
		
		
		public PacketBuilder(global::haxe.lang.EmptyObject empty) {
		}
		
		
		public PacketBuilder() {
			global::web.proto.PacketBuilder.__hx_ctor_web_proto_PacketBuilder(this);
		}
		
		
		protected static void __hx_ctor_web_proto_PacketBuilder(global::web.proto.PacketBuilder __hx_this) {
		}
		
		
		public static global::haxe.io.Bytes bytesBuff;
		
		public static int HEADER_SIZE;
		
		public static global::haxe.io.Bytes createPacket(uint mainID, uint sID, int userID, global::haxe.io.Bytes data, object compress) {
			unchecked {
				bool compress1 = ( (( compress == default(object) )) ? (false) : (global::haxe.lang.Runtime.toBool(compress)) );
				if (( data == null )) {
					data = global::org.msgpack.MsgPack.encode(0);
				}
				
				int len = data.length;
				int code = ( (( compress1 == true )) ? (1) : (0) );
				object _head = new global::haxe.lang.DynamicObject(new int[]{}, new object[]{}, new int[]{197623819, 363100693, 1042491189, 1386805980, 1655151068}, new double[]{((double) (((uint) (len) )) ), ((double) (((uint) (code) )) ), ((double) (sID) ), ((double) (((uint) (119) )) ), ((double) (mainID) )});
				object pk = new global::haxe.lang.DynamicObject(new int[]{1106197222, 1113806378, 1158359328}, new object[]{((object) (userID) ), data, _head}, new int[]{}, new double[]{});
				global::haxe.io.Bytes hb = global::org.msgpack.MsgPack.encode(pk);
				global::haxe.io.BytesOutput output = new global::haxe.io.BytesOutput();
				output.writeByte(90);
				output.writeByte(72);
				output.writeByte(89);
				output.writeByte(1);
				output.writeByte(0);
				output.writeByte(0);
				output.writeInt32(hb.length);
				output.write(hb);
				return output.getBytes();
			}
		}
		
		
		public static bool checkKey(int z, int h, int y, int version1, int version2, int version3) {
			unchecked {
				if (( ( ( ( ( z == 90 ) && ( h == 72 ) ) && ( y == 89 ) ) && ( version1 == 1 ) ) && ( version2 == 0 ) )) {
					return ( version3 == 0 );
				}
				else {
					return false;
				}
				
			}
		}
		
		
		public static void addBytes(global::haxe.io.Bytes bytes, global::server.IHander hander, global::haxe.lang.Function callBack) {
			unchecked {
				if (( hander != null )) {
					return;
				}
				
				if (( bytes == null )) {
					return;
				}
				
				if (( bytes.length > 1000 )) {
					callBack.__hx_invoke4_o(default(double), false, default(double), null, default(double), global::web.proto.Web_Error.ERROR, default(double), hander);
				}
				
				if (( global::web.proto.PacketBuilder.bytesBuff == null )) {
					global::web.proto.PacketBuilder.bytesBuff = bytes;
				}
				else {
					global::haxe.io.BytesBuffer buffer = new global::haxe.io.BytesBuffer();
					{
						global::haxe.io.Bytes src = global::web.proto.PacketBuilder.bytesBuff;
						( buffer.b as global::System.IO.Stream ).Write(((byte[]) (src.b) ), ((int) (0) ), ((int) (src.length) ));
					}
					
					( buffer.b as global::System.IO.Stream ).Write(((byte[]) (bytes.b) ), ((int) (0) ), ((int) (bytes.length) ));
					global::web.proto.PacketBuilder.bytesBuff = buffer.getBytes();
				}
				
				if (( ( global::web.proto.PacketBuilder.bytesBuff == null ) || ( global::web.proto.PacketBuilder.bytesBuff.length < 10 ) )) {
					return;
				}
				
				int available = global::web.proto.PacketBuilder.bytesBuff.length;
				global::haxe.io.BytesInput bi = new global::haxe.io.BytesInput(global::web.proto.PacketBuilder.bytesBuff, null, null);
				bi.set_bigEndian(false);
				while (( available >= 10 )) {
					int z = bi.readByte();
					int h = bi.readByte();
					int y = bi.readByte();
					int v1 = bi.readByte();
					int v2 = bi.readByte();
					int v3 = bi.readByte();
					int packetSize = bi.readInt32();
					available -= 10;
					if ( ! (global::web.proto.PacketBuilder.checkKey(z, h, y, v1, v2, v3)) ) {
						global::web.proto.PacketBuilder.bytesBuff = null;
						global::haxe.Log.trace.__hx_invoke2_o(default(double), "fuck you !!! error message", default(double), new global::haxe.lang.DynamicObject(new int[]{302979532, 1547539107, 1648581351}, new object[]{"addBytes", "web.proto.PacketBuilder", "src/web/proto/PacketBuilder.hx"}, new int[]{1981972957}, new double[]{((double) (360) )}));
						available = 0;
						callBack.__hx_invoke4_o(default(double), false, default(double), null, default(double), global::web.proto.Web_Error.ERROR, default(double), hander);
						break;
					}
					
					bool error = false;
					if (( packetSize <= available )) {
						available -= packetSize;
						global::haxe.io.Bytes msgBytes = bi.read(packetSize);
						try {
							object p = global::org.msgpack.MsgPack.decode(msgBytes, null);
							callBack.__hx_invoke4_o(default(double), true, default(double), p, default(double), global::web.proto.Web_Error.OK, default(double), hander);
						}
						catch (global::System.Exception catchallException){
							global::haxe.lang.Exceptions.exception = catchallException;
							{
								object e = ( (( catchallException is global::haxe.lang.HaxeException )) ? (((global::haxe.lang.HaxeException) (catchallException) ).obj) : ((object) (catchallException) ) );
								callBack.__hx_invoke4_o(default(double), false, default(double), null, default(double), global::web.proto.Web_Error.ERROR, default(double), hander);
							}
							
						}
						
						
						break;
					}
					else {
						available += 10;
						break;
					}
					
				}
				
				global::web.proto.PacketBuilder.bytesBuff = null;
				available = 0;
				return;
			}
		}
		
		
	}
}


